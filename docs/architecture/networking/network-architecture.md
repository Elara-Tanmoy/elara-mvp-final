# Elara Platform - Network Architecture

**Document Version**: 1.0
**Last Updated**: 2025-10-24
**Author**: Network Architecture Team
**Status**: Production
**Classification**: Technical - Network Infrastructure

---

## üìã Executive Summary

This document provides the complete network architecture for the Elara cybersecurity platform deployed on Google Cloud Platform. The network design implements **zero-trust security principles**, **defense-in-depth**, and **DDoS protection** through Cloud Armor.

**Key Security Features**:
- ‚úÖ Private VPC with isolated subnets
- ‚úÖ No public IP addresses on databases or internal services
- ‚úÖ Cloud NAT for outbound traffic
- ‚úÖ Cloud Armor WAF with rate limiting
- ‚úÖ Network-level firewall rules
- ‚úÖ IAP (Identity-Aware Proxy) ready for SSH access
- ‚úÖ TLS encryption for all traffic

---

## üåê VPC Network Overview

### Primary VPC: `elara-vpc`

| Parameter | Value |
|-----------|-------|
| **Project** | elara-mvp-13082025-u1 |
| **VPC Name** | elara-vpc |
| **Region** | us-west1 (primary) |
| **Routing Mode** | Regional |
| **DNS** | Google Cloud DNS |

---

## üì° IP Address Allocation

### External IP Addresses (Public)

| Name | IP Address | Type | Usage | Region |
|------|-----------|------|-------|--------|
| **elara-global-lb-ip** | 34.36.48.252 | Global | Production load balancer | Global |
| **elara-dev-backend-ip** | 35.199.176.26 | Regional | Dev backend LoadBalancer | us-west1 |
| **elara-dev-frontend-ip** | 136.117.33.149 | Regional | Dev frontend LoadBalancer | us-west1 |
| **elara-dev-frontend-alt** | 34.11.236.129 | Regional | Dev frontend (additional) | us-west1 |
| **elara-vpc-nat-ip-1** | 34.82.164.36 | Regional | NAT gateway (primary) | us-west1 |
| **elara-vpc-nat-ip-2** | 34.168.119.72 | Regional | NAT gateway (secondary) | us-west1 |

### Internal IP Addresses (Private)

| Resource | IP Address / CIDR | Type | Usage |
|----------|------------------|------|-------|
| **Cloud SQL** | 10.190.1.11 | Private | elara-postgres-optimized |
| **Redis** | 10.190.0.4 | Private | elara-redis-primary |
| **Private IP Range** | 10.190.0.0/24 | Reserved | VPC peering for managed services |

---

## üèóÔ∏è Subnet Configuration

### elara-vpc Subnets

| Subnet Name | CIDR Range | Purpose | Private Google Access |
|-------------|-----------|---------|---------------------|
| **gke-nodes-us-west1** | 10.10.0.0/24 | GKE node IPs | ‚úÖ Enabled |
| **data-layer-us-west1** | 10.20.0.0/24 | Database tier | ‚úÖ Enabled |
| **cloudrun-us-west1** | 10.30.0.0/28 | Cloud Run services | ‚úÖ Enabled |

### GKE Secondary IP Ranges

| Range Name | CIDR Range | Purpose | Size |
|------------|-----------|---------|------|
| **gke-pods-us-west1** | 10.1.0.0/16 | Kubernetes Pods | 65,536 IPs |
| **gke-services-us-west1** | 10.2.0.0/20 | Kubernetes Services (ClusterIP) | 4,096 IPs |

**GKE IP Allocation**:
- **Node IPs**: 10.10.0.0/24 (254 IPs)
- **Pod IPs**: 10.1.0.0/16 (65,536 IPs)
- **Service IPs**: 10.2.0.0/20 (4,096 IPs)
- **Utilization**: 0.49% pod IP usage (current)

---

## üîí Zero-Trust Security Architecture

### 1. Network Segmentation

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        INTERNET                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚îÇ                  ‚îÇ
                 ‚îÇ (HTTPS/443)      ‚îÇ (HTTP/80)
                 ‚ñº                  ‚ñº
      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ  Cloud Armor WAF ‚îÇ  ‚îÇ LoadBalancer IPs ‚îÇ
      ‚îÇ  (DDoS + WAF)    ‚îÇ  ‚îÇ Dev Environments ‚îÇ
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ                     ‚îÇ
               ‚îÇ Rate Limit: 100/min ‚îÇ
               ‚îÇ SQL Injection Block ‚îÇ
               ‚îÇ XSS Protection      ‚îÇ
               ‚ñº                     ‚ñº
      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ  Global Load Balancer (34.36.48.252)  ‚îÇ
      ‚îÇ  - TLS Termination                     ‚îÇ
      ‚îÇ  - CDN Enabled                         ‚îÇ
      ‚îÇ  - Session Affinity                    ‚îÇ
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
               ‚îÇ Internal Traffic Only
               ‚ñº
      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ  GKE Autopilot Cluster (elara-gke-us-west1)      ‚îÇ
      ‚îÇ  Subnet: 10.10.0.0/24                            ‚îÇ
      ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
      ‚îÇ  ‚îÇ Backend     ‚îÇ Frontend     ‚îÇ Proxy Service ‚îÇ  ‚îÇ
      ‚îÇ  ‚îÇ elara-api   ‚îÇ elara-web    ‚îÇ elara-proxy   ‚îÇ  ‚îÇ
      ‚îÇ  ‚îÇ Private IPs ‚îÇ Private IPs  ‚îÇ Private IPs   ‚îÇ  ‚îÇ
      ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ             ‚îÇ               ‚îÇ
                ‚îÇ VPC Peering ‚îÇ               ‚îÇ
                ‚ñº             ‚ñº               ‚îÇ
      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
      ‚îÇ Cloud SQL (Private)              ‚îÇ    ‚îÇ
      ‚îÇ IP: 10.190.1.11                  ‚îÇ    ‚îÇ
      ‚îÇ No Public IP                     ‚îÇ    ‚îÇ
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
                                              ‚ñº
      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ Redis (Private)                  ‚îÇ
      ‚îÇ IP: 10.190.0.4                   ‚îÇ
      ‚îÇ No Public IP                     ‚îÇ
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 2. Outbound Traffic via Cloud NAT

All outbound internet traffic from GKE goes through Cloud NAT (no public IPs on nodes):

```
GKE Pods (10.1.0.0/16)
    ‚îÇ
    ‚îÇ Outbound to Internet
    ‚ñº
Cloud NAT Gateway
    ‚îú‚îÄ> NAT IP 1: 34.82.164.36
    ‚îî‚îÄ> NAT IP 2: 34.168.119.72
        ‚îÇ
        ‚ñº
    Internet
```

**NAT Configuration**:
- Router: `elara-vpc-router-us-west1`
- NAT: `elara-vpc-nat-us-west1`
- IP Allocation: Manual (2 static IPs)
- Subnet Coverage: All subnets in elara-vpc

---

## üõ°Ô∏è Firewall Rules

### Priority-Ordered Firewall Rules

| Priority | Name | Direction | Source | Target | Ports/Protocol | Purpose |
|----------|------|-----------|--------|--------|---------------|---------|
| **999** | gke-inkubelet | INGRESS | 10.1.0.0/16 | GKE nodes | TCP:10255 | Kubelet metrics |
| **1000** | elara-vpc-allow-gke-master | INGRESS | 172.16.0.0/28 | gke-node | TCP:443,10250 | GKE master to nodes |
| **1000** | elara-vpc-allow-health-checks | INGRESS | GCP Health Check IPs | All | TCP | Load balancer health checks |
| **1000** | elara-vpc-allow-iap-ssh | INGRESS | 35.235.240.0/20 | All | TCP:22 | IAP SSH tunneling |
| **1000** | elara-vpc-allow-internal | INGRESS | 10.1.0.0/16, 10.2.0.0/20, 10.10.0.0/24, 10.20.0.0/24, 10.30.0.0/28 | All | All | Internal VPC traffic |
| **1000** | k8s-fw-loadbalancers | INGRESS | 0.0.0.0/0 | GKE nodes | TCP:80 | LoadBalancer services |
| **1000** | k8s-fw-l7-backends | INGRESS | 130.211.0.0/22, 35.191.0.0/16 | GKE nodes | TCP:3001,8080 | Ingress backends |
| **2000** | elara-vpc-deny-external-rdp | INGRESS | 0.0.0.0/0 | All | TCP:3389 | **DENY RDP** |
| **2000** | elara-vpc-deny-external-ssh | INGRESS | 0.0.0.0/0 | All | TCP:22 | **DENY SSH** (use IAP) |

**Security Notes**:
- ‚úÖ **No direct SSH/RDP allowed** - Use Cloud IAP for access
- ‚úÖ **Internal traffic allowed** - All RFC1918 ranges within VPC
- ‚úÖ **Health checks allowed** - Google Cloud health check IP ranges
- ‚úÖ **LoadBalancer services** - Port 80 for dev environment LBs

---

## üîê Cloud Armor Security Policies

### Policy: `elara-security-policy`

Applied to production global load balancer (34.36.48.252).

| Priority | Rule | Action | Description |
|----------|------|--------|-------------|
| **1000** | Rate Limiting | rate_based_ban | 100 requests/minute per IP, 10min ban |
| **2000** | SQL Injection | deny(403) | Block using preconfigured WAF rule (sqli-v33-stable) |
| **3000** | XSS Protection | deny(403) | Block using preconfigured WAF rule (xss-v33-stable) |
| **2147483647** | Default | allow | Allow all other traffic |

**DDoS Protection**:
- ‚úÖ **Rate limiting**: 100 requests/minute per source IP
- ‚úÖ **Ban duration**: 600 seconds (10 minutes)
- ‚úÖ **Exceed action**: HTTP 403 Forbidden
- ‚úÖ **SQL Injection detection**: WAF preconfigured rule
- ‚úÖ **XSS detection**: WAF preconfigured rule
- ‚úÖ **Google Cloud Armor**: Layer 7 DDoS mitigation (automatic)

---

## üöÄ Landing Zone Architecture

### Production Landing Zone (34.36.48.252)

```
Internet Traffic
    ‚îÇ
    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Global HTTPS Load Balancer              ‚îÇ
‚îÇ IP: 34.36.48.252                        ‚îÇ
‚îÇ                                          ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ ‚îÇ Cloud Armor Security Policy         ‚îÇ ‚îÇ
‚îÇ ‚îÇ - Rate Limiting (100 req/min)       ‚îÇ ‚îÇ
‚îÇ ‚îÇ - SQL Injection Protection          ‚îÇ ‚îÇ
‚îÇ ‚îÇ - XSS Protection                    ‚îÇ ‚îÇ
‚îÇ ‚îÇ - DDoS Mitigation                   ‚îÇ ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                          ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ ‚îÇ SSL/TLS Termination                 ‚îÇ ‚îÇ
‚îÇ ‚îÇ Managed Certificate (auto-renew)    ‚îÇ ‚îÇ
‚îÇ ‚îÇ Domains: elara.com, api.elara.com   ‚îÇ ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                          ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ ‚îÇ Backend Configuration               ‚îÇ ‚îÇ
‚îÇ ‚îÇ - Health checks: /health (HTTP)     ‚îÇ ‚îÇ
‚îÇ ‚îÇ - Session affinity: CLIENT_IP       ‚îÇ ‚îÇ
‚îÇ ‚îÇ - Connection draining: 300s         ‚îÇ ‚îÇ
‚îÇ ‚îÇ - Timeout: 30s                      ‚îÇ ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îÇ Forwarding to GKE Backend NEG
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ GKE Ingress (elara-backend namespace)   ‚îÇ
‚îÇ Service: elara-api-service              ‚îÇ
‚îÇ Type: ClusterIP (internal only)         ‚îÇ
‚îÇ Port: 80 ‚Üí 3001                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Development Landing Zones

**Dev Backend** (35.199.176.26):
- Type: LoadBalancer Service
- Service: elara-api-lb (elara-backend-dev namespace)
- No Cloud Armor (development only)

**Dev Frontend** (136.117.33.149 + 34.11.236.129):
- Type: LoadBalancer Service
- Service: elara-frontend-lb (elara-frontend-dev namespace)
- Direct internet access for development

---

## üîê IAM & Service Account Network Access

### Workload Identity Bindings

| Service Account | K8s Namespace | K8s SA | Network Access |
|----------------|---------------|--------|----------------|
| **elara-api** | elara-backend | elara-api-sa | VPC private access to Cloud SQL, Redis |
| **elara-worker** | elara-workers | elara-worker-sa | VPC private access + Cloud Storage |
| **elara-proxy** | elara-proxy | elara-proxy-sa | Outbound via Cloud NAT |
| **elara-frontend** | elara-frontend | elara-frontend-sa | Minimal network access |

**Zero-Trust Access**:
- ‚úÖ Service accounts use Workload Identity (no key files)
- ‚úÖ Least privilege network access
- ‚úÖ No public IPs on service accounts
- ‚úÖ All database access via private VPC peering

---

## üìä Network Monitoring & Logging

### VPC Flow Logs

**Status**: Enabled for security subnets
- **Sample Rate**: 50%
- **Metadata**: Full metadata collection
- **Log Filter**: All traffic
- **Retention**: 30 days in Cloud Logging

### Firewall Rule Logging

**Enabled Rules**:
- All DENY rules (SSH, RDP blocks)
- Cloud Armor policy hits
- Suspicious traffic patterns

### Cloud NAT Logging

**Status**: Enabled
- **Log Type**: Translation and errors
- **Destination**: Cloud Logging
- **Filter**: All NAT events

---

## üõ†Ô∏è Network Troubleshooting

### Common Network Paths

**1. External User ‚Üí Production API**:
```
User ‚Üí 34.36.48.252:443 (Cloud Armor) ‚Üí Global LB ‚Üí GKE Ingress ‚Üí
elara-api-service (10.2.x.x) ‚Üí Backend Pod (10.1.x.x)
```

**2. Backend Pod ‚Üí Cloud SQL**:
```
Backend Pod (10.1.x.x) ‚Üí VPC Peering ‚Üí Cloud SQL (10.190.1.11:5432)
```

**3. Backend Pod ‚Üí Internet API**:
```
Backend Pod (10.1.x.x) ‚Üí Cloud NAT (34.82.164.36 or 34.168.119.72) ‚Üí Internet
```

**4. Backend Pod ‚Üí Redis**:
```
Backend Pod (10.1.x.x) ‚Üí VPC Internal ‚Üí Redis (10.190.0.4:6379)
```

### Network Diagnostic Commands

```bash
# Test Cloud SQL connectivity from GKE pod
kubectl exec -it <pod-name> -n elara-backend -- nc -zv 10.190.1.11 5432

# Test Redis connectivity
kubectl exec -it <pod-name> -n elara-backend -- nc -zv 10.190.0.4 6379

# Check NAT IP usage
gcloud compute routers get-nat-mapping-info elara-vpc-router-us-west1 \
  --region=us-west1 --nat-name=elara-vpc-nat-us-west1

# Verify Cloud Armor policy
gcloud compute security-policies describe elara-security-policy

# Check firewall rule hits
gcloud logging read "resource.type=gce_firewall_rule" --limit 50
```

---

## üí∞ Network Costs

### Current Monthly Network Costs

| Component | Configuration | Monthly Cost |
|-----------|--------------|--------------|
| **Cloud NAT** | 2 static IPs + data processing | $30-50 |
| **Global Load Balancer** | Forwarding rules + data processing | $40 |
| **Cloud Armor** | Security policy + rules | $20 |
| **VPC Network** | Included (no charge) | $0 |
| **Private Service Connection** | VPC peering for Cloud SQL/Redis | $0 |
| **Network Egress** | ~200GB/month | $20-30 |
| **Total Network Costs** |  | **$110-140/month** |

---

## ‚úÖ Security Compliance

### Zero-Trust Principles Implemented

| Principle | Implementation | Status |
|-----------|---------------|--------|
| **Verify Explicitly** | IAM + Workload Identity + Cloud Armor | ‚úÖ |
| **Least Privilege Access** | Service account roles + Firewall rules | ‚úÖ |
| **Assume Breach** | Network segmentation + private IPs + monitoring | ‚úÖ |
| **Encrypt Everything** | TLS in transit + encryption at rest | ‚úÖ |
| **Segment Network** | Subnets per tier + VPC isolation | ‚úÖ |
| **Monitor Continuously** | VPC Flow Logs + Firewall logs + Cloud Armor logs | ‚úÖ |

### Compliance Readiness

- ‚úÖ **PCI DSS**: Network isolation, encryption, monitoring
- ‚úÖ **SOC 2**: Access controls, logging, DDoS protection
- ‚úÖ **ISO 27001**: Information security controls
- ‚úÖ **GDPR**: Data residency (us-west1), encryption

---

## üöÄ Network Scaling & Performance

### Current Capacity

- **Global Load Balancer**: Up to 1M requests/second
- **Cloud Armor**: Unlimited DDoS protection
- **VPC**: 65,536 pod IPs available (99.5% unused)
- **NAT Gateway**: Auto-scaling ports (up to 64K connections)
- **Bandwidth**: Regional bandwidth (unlimited within region)

### Network SLAs

| Component | SLA | Current Uptime |
|-----------|-----|----------------|
| **Global Load Balancer** | 99.99% | ‚úÖ Active |
| **Cloud Armor** | 99.99% | ‚úÖ Active |
| **Cloud NAT** | 99.99% | ‚úÖ Active |
| **VPC** | 99.99% | ‚úÖ Active |

---

## üìù Change Log

| Date | Version | Changes |
|------|---------|---------|
| 2025-10-24 | 1.0 | Initial network architecture documentation |

---

**Document Status**: ‚úÖ Production Ready
**Verified**: All IPs and configurations verified via gcloud CLI
**Last Verification**: 2025-10-24
